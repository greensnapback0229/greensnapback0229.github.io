---
layout: post
title: (COMAtching) OpenAI ì—°ë™ ë¹„ë™ê¸° AI í† í° ìŠ¤íŠ¸ë¦¬ë° ê°œì„ 
date: 2026-1-19 23:38
category: [Magicofconch, Troubleshooting]
author: greensnapback0229
tags: [spring-boot, webflux, asynchronous, SSE]
summary: 
---

# (MagicOfConch) OpenAI ì—°ë™ ë¹„ë™ê¸° AI í† í° ìŠ¤íŠ¸ë¦¬ë° ê°œì„   

<br>

> MagicOfConch(ë§ˆë²•ì˜ ì†Œë¼ê³ ë™) í”„ë¡œì íŠ¸ì˜ ë¦¬ë·° í† í° ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ì„ ê°œì„ í•˜ëŠ” ê³¼ì •ì— ëŒ€í•œ ê¸€ì…ë‹ˆë‹¤. 
> Stack: Spring-Boot, Webflux, Asynchronous



## ìƒí™© 

### âš™ï¸ ì–´ë–¤ ê¸°ëŠ¥ì¸ê°€? 

![img](https://github.com/TeamMagicOfConch/sora/raw/main/readme/intro1.gif)

ë¦¬ë·° ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©ìê°€ íšŒê³ (or ì¼ê¸°)ë¥¼ ì‘ì„±í•˜ë©´ ì‚¬ìš©ìê°€ ì„ íƒí•œ MBTI `T`(í˜„ì‹¤ì  ì¡°ì–¸)/`F`(ê°ì •ì  ê³µê°) íƒ€ì…ìœ¼ë¡œ íŠœë‹ëœ LLMì„ í˜¸ì¶œí•˜ì—¬ AIì˜ ë¦¬ë·°ë¥¼ '<u>í† í° ë‹¨ìœ„</u>'ë¡œ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° í›„ ì„œë²„ì— ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. 



### ğŸ’­ í† í° ìŠ¤íŠ¸ë¦¬ë°..?

í† í°ì€ ì–¸ì–´ ëª¨ë¸ì´ í…ìŠ¤íŠ¸ë¥¼ ì´í•´í•˜ê³  ìƒì„±í•˜ëŠ” ê¸°ë³¸ ë‹¨ìœ„ì…ë‹ˆë‹¤. ChatGPTë¥¼ ì›¹ìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ ì‚¬ìš©í•´ë³´ë©´ ì‚¬ìš©ìê°€ í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•˜ê³  ë‹µì„ ìš”ì²­í•˜ë©´, GPTëŠ” í•œë²ˆì— ëª¨ë“  ê¸€ìê°€ ì˜¬ë¼ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë§ˆì¹˜ í•œê¸€ìì”© ì „ì†¡ë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤. 

LLM ëª¨ë¸ì´ í† í° ë‹¨ìœ„ë¡œ ì‘ë‹µì„ ìƒì„±í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ì•„ì˜¤ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤. 

ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ì•„ì™”ì„ë•Œì˜ ì¥ì ìœ¼ë¡œëŠ” ì‘ë‹µ í† í°ì„ ëª¨ë‘ ê¸°ë‹¤ë ¸ë‹¤ê°€ í•˜ë‚˜ì˜ ì‘ë‹µ ë¬¸ìì—´ë¡œ ì˜¤ëŠ” ê²ƒë³´ë‹¤ ë¹ ë¥´ê²Œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‘ë‹µì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. 

ì‘ë‹µì´ ê¸¸ì–´ì§€ê²Œ ë˜ë©´ 2-3ì´ˆ ì •ë„ë¡œ ìƒê°ë³´ë‹¤ ê¸´ ì‹œê°„ì„ ì‚¬ìš©ìê°€ ëŒ€ê¸°í•´ì•¼ í–ˆê¸° ë•Œë¬¸ì— <u>ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„ì€ ì¤‘ìš”í•œ ìš”êµ¬ì‚¬í•­ì´ì—ˆìŠµë‹ˆë‹¤.</u>

OpenAI APIë„ Streaming ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤. ( <a href="https://docs.spring.io/spring-ai/reference/api/chat/openai-chat.html">ê³µì‹ API Docs</a> )



## ê¸°ì¡´ êµ¬í˜„

OpenAIë¥¼ í˜¸ì¶œí•˜ê³  ì‹¤ì‹œê°„ í† í° ìŠ¤íŠ¸ë¦¬ë°ì„ ì ìš©í•˜ê¸° ìœ„í•´ì„œ Spring ê³µì‹ í”„ë ˆì„ì›Œí¬ì¸ Spring-AIì˜ <a href="https://docs.spring.io/spring-ai/reference/api/chat/openai-chat.html">ChatClient</a>ë¥¼ í™œìš©í–ˆìŠµë‹ˆë‹¤. 

ChatClientëŠ” LLM **í˜¸ì¶œìš© ê°ì²´**ë¡œ ì•„ë˜ì™€ ê°™ì€ ì‘ì—…ë“¤ì„ Spring ê°œë°œìì—ê²Œ ì¹œìˆ™í•œ í˜•íƒœë¡œ ì œê³µí•©ë‹ˆë‹¤.

- HTTP ìš”ì²­ ì§ì ‘ êµ¬ì„±
- API Key ê´€ë¦¬
- ëª¨ë¸ë³„ ìš”ì²­ í¬ë§· ì°¨ì´ ì²˜ë¦¬
- ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
- ë©”ì‹œì§€(role, content) êµ¬ì¡° ê´€ë¦¬

<br>

í˜„ì¬ëŠ” ì„œë²„ê°€ ë¶„ë¦¬ë˜ì–´ ìˆì§€ë§Œ í”„ë¡œì íŠ¸ ì´ˆê¸°ì—ëŠ” ê·œëª¨ê°€ ì ì–´ ë‹¨ì¼ ì„œë²„ë¡œ ìš´ì˜í–ˆê¸° ë•Œë¬¸ì— review ì„œë²„ë¥¼ ë”°ë¡œ ë‘ì§€ì•Šê³  MVC ê¸°ë°˜ì˜ ì„œë²„ì—ì„œ í•´ë‹¹ ê¸°ëŠ¥ì„ ì œê³µí•˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.  

 

> ğŸ¥ ì‹œë‚˜ë¦¬ì˜¤

![reivew_seq](/assets/Mermaid Chart - Create complex, visual diagrams with text.-2026-01-20-175814.png)

ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì§„í–‰ë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ ì˜€ìŠµë‹ˆë‹¤. 

1. ì‚¬ìš©ì íšŒê³ ì‘ì„± 
2. BE ì„œë²„ ì „ì†¡ 
3. OpenAI í˜¸ì¶œ 
4. ìŠ¤íŠ¸ë¦¬ë° 
5. Database ì €ì¥

<br>

ê¸°ë³¸ì ìœ¼ë¡œ SSE í† í° ìŠ¤íŠ¸ë¦¬ë°ì„ ë°›ì„ë•Œ REST ê¸°ë°˜ì˜ HTTP í†µì‹ ì´ ì•„ë‹Œ <u>SSE(Server Sent Event)ë¥¼ í†µì‹ ì„ í†µí•´ API ì„œë²„ë¡œ ë‹¨ë°©í–¥ ë¹„ë™ê¸°ë¡œ í† í°</u>ì„ ìˆ˜ì‹ í–ˆìŠµë‹ˆë‹¤. 

ì´ë•Œ ChatClientëŠ” í•´ë‹¹ ì‘ë‹µì„ Fluxí˜•íƒœë¡œ ë¦¬í„´í•©ë‹ˆë‹¤. (<a  href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux ìë£Œêµ¬ì¡°</a>)

FluxëŠ” ë°ì´í„°ë¥¼ ì‹œê°„ì— ë”°ë¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ í˜ë ¤ë³´ë‚´ëŠ” Reactive Streams ê¸°ë°˜ì˜ ë…¼ë¸”ë¡œí‚¹ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì…ë‹ˆë‹¤. ë•Œë¬¸ì— MVC êµ¬ì¡°ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ê¶Œì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 



### ğŸ§‘â€ğŸ’» ì´ˆê¸° êµ¬í˜„ 

MVC ê¸°ë°˜ ì„œë²„ì—ì„œ ChatClientë¥¼ í†µí•´ ë°›ì€ ì‘ë‹µì„ SSEë¡œ ìŠ¤íŠ¸ë¦¬ë°í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•œ ì½”ë“œì…ë‹ˆë‹¤. 

[ReviewService.java]

``` java
@Slf4j
@Service
@RequiredArgsConstructor
public class ReviewService {
	private final OpenAiChatModel openAiChatModel;
  private final ReviewRepository reviewRepository;
  private final SecurityUtil securityUtil;
  private final EncryptionUtil encryptionUtil;
  private final DataSource dataSource;

	@Value("${prompt.sora-type.T}")
	private String promptAsT;

	@Value("${prompt.sora-type.F}")
	private String promptAsF;


	/**
	 * todo : Review Entity ìƒì„± í›„ ì €ì¥
	 * @param req : ì†Œë¼ íšŒê³  ë¦¬ë·° ìš”ì²­
	 * @return : ì†Œë¼ ì‘ë‹µ
	 */
	public Flux<String> requestSora(SoraReviewReq req){
		Message userMessage = new UserMessage(req.getBody());
		SystemPromptTemplate systemPromptTemplate;
		FeedbackType requestType = req.getType();

		if(requestType.equals(FeedbackType.FEELING)){
			systemPromptTemplate = new SystemPromptTemplate(promptAsF);
		}
		else{
			systemPromptTemplate = new SystemPromptTemplate(promptAsT);
		}

		Message systemMessage = systemPromptTemplate.createMessage();

		// ì „ì²´ ì‘ë‹µì„ ì €ì¥í•  StringBuilder
		AtomicReference<StringBuilder> fullResponse = new AtomicReference<>(new StringBuilder());

		return openAiChatModel.stream(userMessage, systemMessage)
			.doOnNext(response -> {
				fullResponse.get().append(response); // ì „ì²´ ì‘ë‹µ ëˆ„ì 
			})
			.doOnComplete(() -> {
				// ìŠ¤íŠ¸ë¦¼ ì™„ë£Œ ì‹œ ëˆ„ì ëœ ì‘ë‹µì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
				saveToDatabase(fullResponse.get().toString()).subscribe();
			});

	}

	private Mono<Void> saveToDatabase(String fullResponse) {
		/** 
				DB ì €ì¥ ë¡œì§ ìƒëµ
		*/
		return Mono.empty();
	}
}
```



[ReviewController.java]

```java
@RestController
@RequiredArgsConstructor
public class ReviewController {

  private final ReviewService reviewService;

  @PostMapping(value = "/test/api/request/review", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
  public Flux<String> requestSora(@RequestBody SoraReviewReq req) {
    Flux<String> feedback = reviewService.requestSora(req);

    return feedback;
  }
}
```

<br> 

ìœ„ ì½”ë“œ êµ¬í˜„ì€ 2ê°€ì§€ ë¬¸ì œì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

### ğŸ¤” ë¬¸ì œì  - 1

FluxëŠ” Reactorê¸°ë°˜ì˜ Webflux í”„ë¡œì íŠ¸ì—ì„œNetty Event Loopë¥¼ ì‚¬ìš©í–ˆì„ë•Œ íš¨ìœ¨ì ì´ê³  Reactor Contextë¡œ ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. 

í•˜ì§€ë§Œ ìœ„ ì²˜ëŸ¼ MVC ê¸°ë°˜ì˜ í”„ë¡œì íŠ¸ì—ì„œ ë°˜í™˜í•˜ê²Œ ë˜ë©´, Async Thread poolì„ ì‚¬ìš©í•˜ê¸´ í•˜ì§€ë§Œ Context ìœ ì§€ê°€ ë˜ì§€ ì•Šì•„ì„œ SSE ì´í›„ ì €ì¥í•˜ëŠ” ê³¼ì •ì—ì„œ Security Context ìœ ì§€ê°€ ì•ˆë˜ì„œ `AuthenticationPrincipal` ì„ ê°€ì ¸ì˜¤ëŠ”ë° ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. 

ë˜í•œ SecurityContext ë‚´ìš©ì„ ìˆ˜ë™ìœ¼ë¡œ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•œë‹¤ê³  í•´ë„ DB ì»¤ë„¥ì…˜í’€ì´ ìƒì„±ë§Œë˜ê³  ë°˜ë‚©ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. 

`doOnComplete()` ìˆ˜í–‰ì‹œ ê°™ì€ ë¼ì´í”„ ì‚¬ì´í´ì•ˆì—ì„œ ê´€ë¦¬ë˜ì§€ ì•Šê³  ë¹„ë™ê¸°ë¡œ ìˆ˜í–‰ë˜ê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ì— ë¬¶ì¼ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤. 

![flux_seq](/assets/flux_seq-8955756.png)



### ğŸ¤” ë¬¸ì œì  - 2

MVC ê¸°ë°˜ì—ì„œ SSE ì—°ê²°ì„ í•˜ë©´ Tomcat worker threadëŠ” ë°˜í™˜ë˜ì§€ë§Œ ì—°ê²° ìœ ì§€ë¥¼ ìœ„í•œ Servlet AsyncContext ì»¨í…ìŠ¤íŠ¸ëŠ” ìŠ¤íŠ¸ë¦¬ë°ì´ ì¢…ë£Œë ë•Œê¹Œì§€ ì—°ê²°ì„ ì ìœ í•©ë‹ˆë‹¤.

ì—°ê²° ê°œìˆ˜ë§Œí¼ AsyncContextê°€ ìƒì„±ë©ë‹ˆë‹¤. 100ê°œì˜ ì—°ê²°ì´ ìˆìœ¼ë©´ 100ê°œê°€ ìƒì„±ë©ë‹ˆë‹¤. AsyncContextì™€ ê°™ì€ ë¬´ê±°ìš´ ìš”ì²­ ìƒíƒœê°€ ì§€ì†ì ìœ¼ë¡œ ì¦ê°€í•˜ë©´ GC ë¶€ë‹´ì´ ì»¤ì§ˆ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ì—ˆìŠµë‹ˆë‹¤. 

> AsyncContext = ServletRequest + Response + buffer + ê´€ë¦¬ ê°ì²´

ë™ì‹œì ‘ì†ì ìˆ˜ê°€ ëŠ˜ì–´ì§ˆìˆ˜ë¡ MVCëŠ” ë™ì‹œ ì ‘ì†ìê°€ ì¦ê°€í•˜ë©´ ë¹„ë™ê¸° ì²˜ë¦¬Â·ì‘ë‹µ ì „ì†¡Â·íƒ€ì„ì•„ì›ƒ ê´€ë¦¬ ë“±ì„ ìœ„í•´ ë‚´ë¶€ì ìœ¼ë¡œ ìŠ¤ë ˆë“œ í’€ì´ í™•ì¥ë˜ë©°, ê²°ê³¼ì ìœ¼ë¡œ ìŠ¤ë ˆë“œ ìˆ˜ ì¦ê°€ë¥¼ í”¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 

ë§Œì•½ ë°¤ì‹œê°„ê³¼ ê°™ì´ ì¼ê¸°ë¥¼ ì“°ëŠ” ì‚¬ìš©ìê°€ ë¶ë¹„ëŠ” ì‹œê°„ì— ë™ì‹œì ‘ì†ì ìˆ˜ê°€ maxThreads ë³´ë‹¤ ë§ì•„ì§ˆ ê²½ìš° ì„œë²„ê°€ íŠ¹ì • ì„ê³„ì ì—ì„œ ì„œë²„ê°€ ë»—ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ì—ˆìŠµë‹ˆë‹¤. 



## ê°œì„  

![better_review_arc](/assets/better_review_arc.jpg)

admin ëª¨ë“ˆì„ ì¶”ê°€í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ë©€í‹°ëª¨ë“ˆ ì•„í‚¤í…ì²˜ë¡œ ì „í™˜í•˜ëŠ” ê³¼ì •ì—ì„œ webfluxë¡œ í•¨ê»˜ ë¶„ë¦¬í•˜ë©° Streaming ê´€ë ¨ ê¸°ìˆ ë¶€ì±„ë¥¼ í•´ì†Œí•˜ê³ ì í–ˆìŠµë‹ˆë‹¤. 

webflux ëª¨ë“ˆì„ ì¶”ê°€í•˜ê³  í† í° ìŠ¤íŠ¸ë¦¬ë° ìš”ì²­ì€ ëª¨ë‘ streaming ì„œë²„ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ê¸°ëŠ¥ì„ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤. 



### ğŸ¤” ì €ì¥ ì²˜ë¦¬ì— ê´€í•œ ê³ ë¯¼

AIì˜ ë¦¬ë·°ê°€ ì™„ë£Œë˜ë©´ DBë¡œ ì €ì¥í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í–ˆëŠ”ë° ê¸°ì¡´ JPA, JDBCê°™ì€ ë¸”ë¡œí‚¹ ì„œë¹„ìŠ¤ì™€ í•¨ê»˜ ì“°ëŠ” ê²ƒì€ Webfluxì—ì„œ <a href="https://docs.spring.io/spring-framework/reference/web/webflux/new-framework.html?utm_source=chatgpt.com#webflux-framework-choice">ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  </a>

WebFluxëŠ” ì™„ì „ ë¹„ë™ê¸°/ë…¼ë¸”ë¡œí‚¹ ìŠ¤íƒì´ê¸° ë•Œë¬¸ì—, ë¸”ë¡œí‚¹ I/Oë¥¼ ì„ìœ¼ë©´ non-blockingì˜ ì¥ì ì„ ì‚´ë¦¬ê¸° ì—¬ëŸ½ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 

R2DBCë¼ëŠ” JDBCë¥¼ ëŒ€ì²´í•˜ê¸° ìœ„í•œ ëŒ€ì•ˆì´ ìˆê¸´ í–ˆì§€ë§Œ ê¸°ì¡´ @Transactionalê³¼ ë‹¤ë¥¸ íŒ¨ëŸ¬ë‹¤ì„ê³¼ ëŸ¬ë‹ ì»¤ë¸Œë¡œ ì¸í•´ì„œ ë„ì…í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ëŒ€ì‹ , ê¸°ì¡´ MVC ì„œë²„ì—ì„œ ì €ì¥ê¸°ëŠ¥ì€ ìœ ì§€í•˜ê³  streaming ì„œë²„ì—ì„œ í† í° ìŠ¤íŠ¸ë¦¬ë°ì´ ëë‚˜ë©´ ê¸°ì¡´ ì„œë²„ë¡œ ì €ì¥ìš”ì²­ì„ ë³´ë‚´ëŠ” êµ¬ì¡°ë¡œ ê°œë°œí–ˆìŠµë‹ˆë‹¤. 



### âŒ¨ï¸ ì½”ë“œ

[SoraService.java]

```java
@Slf4j
@Service
@RequiredArgsConstructor
public class SoraService {
  
	private final OpenAiChatModel chatClient;
	private final WebClient webClient;
	private final JwtUtil jwtUtil;
	private final ObjectMapper objectMapper;
  
	@Value("${prompt.sora-type.T}")
	private String promptAsT;
	@Value("${prompt.sora-type.F}")
	private String promptAsF;
	@Value("${sora.srv.url}")
	private String appServer;

	/**
	 * open-ai ìŠ¤íŠ¸ë¦¬ë° ë©”ì„œë“œ
	 *
	 * @param req
	 * @return
	 */
	public Flux<ReviewRes> streamReview(SubmitReq req, String token) {
		if (token == null || !jwtUtil.validateToken(token) || jwtUtil.isExpired(token)) {
			throw new ResponseStatusException(HttpStatus.UNAUTHORIZED, "Unauthorized");
		}

		String username = jwtUtil.getUsername(token);
		String prompt = (req.getType() == FeedbackType.FEELING ? promptAsF : promptAsT)
			.replace("{name}", username) + "\n" + req.getBody();

		AtomicReference<StringBuilder> bufferRef = new AtomicReference<>(new StringBuilder());

		return chatClient.stream(prompt)
			.doOnNext(text -> bufferRef.get().append(text))
			.index()
			.map(tuple -> ReviewRes.builder()
				.seq(tuple.getT1().intValue())
				.value(tuple.getT2())
				.build())
			.doOnComplete(() -> {
				String feedback = bufferRef.get().toString();
				sendToServer(req, feedback, token);
			});
	}
  
  
  /**
	 * ì„œë²„ì— ë¦¬ë·° ì €ì¥
	 *
	 * @param req
	 * @param feedback
	 * @param token
	 */
	private void sendToServer(SubmitReq req, String feedback, String token) {

		SaveReq saveReq = new SaveReq(req.getBody(), req.getType(), req.getReviewDate(), feedback);

		webClient.post()
			.uri(appServer)
			.contentType(MediaType.APPLICATION_JSON)
			.header(HttpHeaders.AUTHORIZATION, "Bearer " + token)
			.bodyValue(saveReq)
			.retrieve()
			.bodyToMono(Void.class)
			.subscribe();
	}
}
```

> AtomicReference 
>
> - ì—¬ëŸ¬ ì“°ë ˆë“œê°€ ë™ì‹œì— ê°™ì€ ê°ì²´ë¥¼ ì°¸ì¡°í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìë£Œêµ¬ì¡°  
> - ë©€í‹° ìŠ¤ë ˆë”© í™˜ê²½ì—ì„œë„ ì›ìì„±ì„ ë³´ì¥í•˜ì—¬ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œí•¨ 

Flux ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì— ë¦¬ë·° ë¬¸ìì—´ì„ ì•ˆì „í•˜ê²Œ ëˆ„ì í•˜ê³ , ìŠ¤íŠ¸ë¦¼ ì™„ë£Œ ì‹œ ìµœì¢… ê²°ê³¼ë¥¼ í•œ ë²ˆë§Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReference.html">`AtomicReference`</a>ë¥¼ ë²„í¼ì²˜ëŸ¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. 



[SoraController.java]

```java
@Slf4j
@RestController
@RequiredArgsConstructor
public class SoraController {

	private final String BEARER_TOKEN = "Bearer ";

	private final SoraService soraService;

	@PostMapping(value = "/stream/review",
		consumes = MediaType.APPLICATION_JSON_VALUE,
		produces = MediaType.TEXT_EVENT_STREAM_VALUE
	)
	public Flux<ReviewRes> streamReview(@RequestBody SubmitReq req, ServerHttpRequest request) {
		String authHeader = request.getHeaders().getFirst(HttpHeaders.AUTHORIZATION);
		String token =
			(authHeader != null && authHeader.startsWith(BEARER_TOKEN)) ? authHeader.substring(BEARER_TOKEN.length()) :
				null;

		return soraService.streamReview(req, token);
	}
}
```

