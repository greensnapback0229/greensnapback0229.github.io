---
layout: post
title: (COMAtching) Redisë¥¼ í™œìš©í•œ í¬ì¸íŠ¸ ì¶©ì „ ë©±ë“±ì„± ë³´ì¥ - 1
date: 2025-12-23 23:38
category: [COMAtching, Troubleshooting]
author: greensnapback0229
tags: [diagram, ê¸°ìˆ ìŠ¤íƒ]
summary: 
---

# Redisë¥¼ í™œìš©í•œ ë§¤ì¹­ ê¸°ëŠ¥ ë©±ë“±ì„± ë³´ì¥-1

> COMAtching í”„ë¡œì íŠ¸ ìš´ì˜ì¤‘ ìƒê¸´ ë©±ë“±ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê³¼ì •ì— ëŒ€í•œ ê¸€ì…ë‹ˆë‹¤.  
> Stack: Spring-Boot, Java, Redis, HTTP



## ë¬¸ì œìƒí™© 

---

COMAtching ìš”ì²­ì‹œ ì‚¬ìš©ìê°€ ê°™ì€ ë²„íŠ¼ì„ ì—¬ëŸ¬ë²ˆ í´ë¦­í•˜ê²Œ ë˜ì–´ ê°™ì€ ë§¤ì¹­ìš”ì²­ì´ 2ë²ˆ í˜¸ì¶œë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.  

![Stop Charging Your Users Twice: How to Prevent Double-Click on ...](https://miro.medium.com/v2/resize%3Afit%3A1400/1%2AfOEEayvq_iJ5jd-pA__gMA.png)

ìœ„ ê·¸ë¦¼ì²˜ëŸ¼ ì‚¬ìš©ìê°€ ì˜ëª»í•´ì„œ 2ë²ˆ ìš”ì²­ë ê²½ìš° ì„œë²„ëŠ” ë‹¹ì—°í•˜ê²Œë„ 2ë²ˆì˜ ìš”ì²­ì„ ëª¨ë‘ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.  

ì´ë¡œ ì¸í•´ì„œ í•œë²ˆì˜ ë§¤ì¹­ ìš”ì²­ì—ë„ 2ë²ˆì˜ ë§¤ì¹­ì´ ì†Œìš”ë˜ì—ˆê³  <u>í¬ì¸íŠ¸ë„ 2ë°°ë¡œ ì†Œëª¨ë˜ëŠ” ì¹˜ëª…ì ì¸ ë²„ê·¸</u>ì˜€ìŠµë‹ˆë‹¤. 



ğŸ“– ë¬¸ì œí•´ê²°ì„ ìœ„í•´ì„œ ì„ ë¡€ë“¤ì„ ì°¾ì•„ë´¤ê³  ë©±ë“±ì„±ì´ë¼ëŠ” í‚¤ì›Œë“œì— ëŒ€í•´ì„œ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. 



## ë©±ë“±ì„±(Idempotency)ì´ë€?

---

"ë©±ë“±í•˜ë‹¤"ë¼ëŠ” ëœ»ì€ ê°™ì€ ì‘ì—…ì„ ì—¬ëŸ¬ë²ˆ ìˆ˜í–‰í•´ë„, `ê²°ê³¼ ìƒíƒœ`ê°€ í•­ìƒ ë™ì¼í•œ ì„±ì§ˆì´ë¼ê³  ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ì˜ˆë¥¼ ë“¤ì–´ì„œ 

**1. ë©±ë“±í•œ ê²½ìš°**

ì•„ë˜ ìš”ì²­ì€ ì‚¬ìš©ìì˜ ì´ë¦„ì„ íŠ¹ì • ê°’ìœ¼ë¡œ **ì„¤ì •**í•˜ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.

```
PUT /users/1/name
{
  "name": "Jun"
}
```

- 1ë²ˆ í˜¸ì¶œ â†’ ì´ë¦„ = Jun
- 10ë²ˆ í˜¸ì¶œ â†’ ì´ë¦„ = Jun

ê°™ì€ ìš”ì²­ì„ ì—¬ëŸ¬ ë²ˆ ìˆ˜í–‰í•˜ë”ë¼ë„,
 ì‚¬ìš©ìì˜ ì´ë¦„ì´ë¼ëŠ” **ê²°ê³¼ ìƒíƒœëŠ” í•­ìƒ ë™ì¼í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤**.

ë”°ë¼ì„œ ì´ ìš”ì²­ì€ **ë©±ë“±í•˜ë‹¤**ê³  ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



**2. ë©±ë“±í•˜ì§€ ì•Šì€ ê²½ìš°**

ì•„ë˜ ìš”ì²­ì€ í¬ì¸íŠ¸ë¥¼ **ëˆ„ì **í•´ì„œ ì¦ê°€ì‹œí‚¤ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.

```
POST /points/add
{
  "amount": 100
}
```

- 1ë²ˆ í˜¸ì¶œ â†’ +100
- 2ë²ˆ í˜¸ì¶œ â†’ +200
- 3ë²ˆ í˜¸ì¶œ â†’ +300

ìš”ì²­ì„ ìˆ˜í–‰í•  ë•Œë§ˆë‹¤ í¬ì¸íŠ¸ê°€ ê³„ì† ì¦ê°€í•˜ë©´ì„œ,
 **í˜¸ì¶œ íšŸìˆ˜ì— ë”°ë¼ ê²°ê³¼ ìƒíƒœê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤**.

ì´ ê²½ìš°ì—ëŠ” **ë©±ë“±í•˜ì§€ ì•Šë‹¤**ê³  ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 





### ğŸ¤” ë§¤ì¹­ ê¸°ëŠ¥ì€ ë©±ë“±í–ˆì„ê¹Œ? 



> ë§¤ì¹­ ê¸°ëŠ¥ì˜ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

![matching_seq.png](/assets/matching_seq.png)

ë§¤ì¹­ ê¸°ëŠ¥ì€ HTTP POST ë©”ì„œë“œë¡œ í˜¸ì¶œë˜ê³  bodyì— ë‹´ê¸´ ë§¤ì¹­ ì˜µì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ ë§¤ì¹­ ê²°ê³¼ë¥¼ DBì— ì €ì¥í•˜ê³  ì‘ë‹µí•˜ëŠ” ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤. 

**<a href="https://www.rfc-editor.org/rfc/rfc7231#section-4.2.2"> RFC 7231 (HTTP/1.1) </a>**ì—ì„œëŠ” POST ë©”ì„œë“œëŠ” ë©±ë“±í•¨ì„ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  ëª…ì‹œí•˜ê³  ìˆìŠµë‹ˆë‹¤. 

ë§¤ì¹­ ê²°ê³¼ë¥¼ ë§¤ë²ˆ ìƒì„±í•˜ê³  í¬ì¸íŠ¸ë¥¼ ì°¨ê°í•˜ì—¬ DBì— ë°˜ì˜í•˜ê¸° ë•Œë¬¸ì— ê°’ì´ ì§€ì†ì ìœ¼ë¡œ ëˆ„ì ë˜ì–´ ë²ˆí™”í•©ë‹ˆë‹¤. 

*ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë§¤ì¹­ ê¸°ëŠ¥ì€ ë³¸ì§ˆì ìœ¼ë¡œ ë©±ë“±í•˜ì§€ ì•Šì€ ê¸°ëŠ¥ì…ë‹ˆë‹¤.*





## ì–´ë–»ê²Œ ë©±ë“±ì„±ì„ ë³´ì¥í• ê¹Œ? 

---

### ì°¸ê³ 

ê·¸ë ‡ë‹¤ë©´ ì¤‘ë³µ ìš”ì²­ì´ ë°œìƒí–ˆì„ë•Œ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ìˆ˜ë™ìœ¼ë¡œ ë©±ë“±í•¨ì„ ë³´ì¥í•´ì£¼ì–´ì•¼ í–ˆìŠµë‹ˆë‹¤. 

ë¹„ìŠ·í•œ ë¬¸ì œë¥¼ <a href="https://docs.tosspayments.com/blog/what-is-idempotency#%EB%A9%B1%EB%93%B1%ED%95%9C-%EC%9A%94%EC%B2%AD%EC%9D%B8%EC%A7%80-%EC%95%8C-%EC%88%98-%EC%9E%88%EB%8A%94-%EB%B0%A9%EB%B2%95">í† ìŠ¤</a>ì—ì„œë„ ê²°ì œë¶€ë¶„ì—ì„œ í•´ê²°í•œ ì‚¬ë¡€ë¥¼ ì°¾ì•„ë³¼ ìˆ˜ ìˆì—ˆê³  ì°¸ê³ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<a href="https://datatracker.ietf.org/doc/html/draft-idempotency-header-01#section-2.7">IETF</a>ì—ì„œëŠ” ë©±ë“±í‚¤(Idempotent-Key)ë¥¼ ìš”ì²­ í—¤ë”ì— í¬í•¨í•˜ì—¬ ê²€ì¦í•˜ëŠ” ë°©ì‹ì„ ì œì•ˆí•©ë‹ˆë‹¤. 

>  ê²€ì¦ ì¡°ê±´

| ì—ëŸ¬ ì½”ë“œ                                                    | ì‹œë‚˜ë¦¬ì˜¤                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [400 Bad Request](https://developer.mozilla.org/ko/docs/Web/HTTP/Status/400) | ë©±ë“±í•´ì•¼ í•˜ëŠ” API ìš”ì²­ì— ë©±ë“±í‚¤ê°€ ëˆ„ë½ëê±°ë‚˜ í˜•ì‹ì— ë§ì§€ ì•ŠëŠ” í‚¤ê°’ì´ ë“¤ì–´ì™”ì„ ë•Œ |
| [409 Conflict](https://developer.mozilla.org/ko/docs/Web/HTTP/Status/409) | ì´ì „ ìš”ì²­ ì²˜ë¦¬ê°€ ì•„ì§ ì§„í–‰ ì¤‘ì¸ë° ê°™ì€ ë©±ë“±í‚¤ë¡œ ìƒˆë¡œìš´ ìš”ì²­ì´ ì˜¬ ë•Œ |
| [422 Unprocessable Entity](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422) | ì¬ì‹œë„ ëœ ìš”ì²­ ë³¸ë¬¸(payload)ì´ ì²˜ìŒ ìš”ì²­ê³¼ ë‹¤ë¥¸ë° ê°™ì€ ë©±ë“±í‚¤ë¥¼ ë˜ ì‚¬ìš©í–ˆì„ ë•Œ |



> <a href="https://www.google.com">Â ğŸ”— Â ë‚´ê°€ ìƒê°í•œ í˜„ì¬ ê²€ì¦ ì¡°ê±´ì˜ ë§¹ì Â </a>



### ì•„í‚¤í…ì²˜ (Architecture)

<img src="/assets/round_robin.png" alt="round_robin" style="width:70%; display:block; margin:0 auto;">

ì„œë²„ì—ì„œ Nginxë¥¼ í†µí•´ Round Robin ë§¤ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ë²ˆê°ˆì•„ê°€ë©° ìš”ì²­ì„ ë°›ê³  ìˆì—ˆê¸° ë•Œë¬¸ì— ì™¸ë¶€ì—ì„œ ê³µë™ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì €ì¥ì†Œë¡œ Redisë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤. 

clientì—ì„œ ë³´ë‚¸ Redisì— ë©±ë“±í‚¤ì™€ bodyë¥¼ key-valueë¡œ ì €ì¥í•˜ì—¬ ìœ„ ê²€ì¦ì¡°ê±´ì„ ë§Œì¡±ì‹œí‚¬ ìˆ˜ ìˆëŠ” ë©±ë“±í•œ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤. 



## êµ¬í˜„ 

---

### ì‘ë™ ë°©ì‹

1. ë©±ë“±í‚¤ë¥¼ clientì—ì„œ ìƒì„±í•˜ì—¬ headerì— ë‹´ì•„ì„œ HTTP ìš”ì²­ì„ ë³´ë‚¸ë‹¤. 

2. í•´ë‹¹í‚¤ì™€ ìš”ì²­ëœ body ë‚´ìš©ì„ `key-value`ìŒìœ¼ë¡œ Redisì— ì €ì¥

3. ë©±ë“±ì„±ì„ ì²´í¬í•˜ê³ ì í•˜ëŠ” Service layer ë©”ì„œë“œ ì‹¤í–‰ì „ Idempotent key í™•ì¸ë¡œì§ ìˆ˜í–‰ 

   ğŸ‘‰ `@Idempotent` ì–´ë…¸í…Œì´ì…˜ê³¼ Spring AOPë¥¼ í™œìš© 

   



> ë©±ë“±ì„± ì²´í¬ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

![idempotent_seq.png](/assets/idempotent_seq.png)



### 1ï¸âƒ£ CachingRequestFilter.java - í•„í„°

```java
public class CachingRequestFilter implements Filter {
	@Override
	public void doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain)
		throws IOException, ServletException {

		HttpServletRequest httpServletRequest = (HttpServletRequest) request;

		if (!"GET".equalsIgnoreCase(httpServletRequest.getMethod())) {
			ContentCachingRequestWrapper wrappedRequest =
				new ContentCachingRequestWrapper(httpServletRequest);
			filterChain.doFilter(wrappedRequest, response);
		} else {
			filterChain.doFilter(request, response);
		}
	}
}
```



### ì™œ Request Bodyë¥¼ ìºì‹±í•´ì•¼ í• ê¹Œ?

ë©±ë“±ì„± ê²€ì¦ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê±´ ë‹¨ìˆœíˆ â€œì´ ìš”ì²­ì´ ì™”ëŠ”ê°€?â€ê°€ ì•„ë‹ˆë¼

ğŸ‘‰ **â€œì´ ìš”ì²­ì´  ì–´ë–¤ ë‚´ìš©ìœ¼ë¡œ ì™”ëŠ”ê°€?â€** ì…ë‹ˆë‹¤.



<u>í•˜ì§€ë§Œ ì—¬ê¸°ì„œ í•œ ê°€ì§€ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.</u>

`HttpServletRequest`ëŠ” **ìš”ì²­ ë³¸ë¬¸ì„ í•œ ë²ˆë§Œ** ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

`HttpServlet`ì€ `ServletInputStream`ì´ë¼ëŠ” ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¡œ ìš”ì²­ì½ê¸° ë•Œë¬¸ì— ë©”ëª¨ë¦¬ì— ìš”ì²­ì„ ì˜¬ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤. 

`@RequesetBody`ì™€ ê°™ì´ Controllerì—ì„œ ì§ë ¬í™”ê°€ ë˜ë©´ ì†Œëª¨ë˜ê³  ëë‚©ë‹ˆë‹¤.  

ë˜í•œ Controllerì—ì„œ ì½ì€ íŒŒë¼ë¯¸í„°ë¥¼ AOPì—ì„œ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 

ê·¸ë˜ì„œ bodyë¥¼ ê²€ì¦í•˜ëŠ” ê³¼ì •ì—ì„œ ì¡°íšŒë¥¼ í•˜ë©´ ì´í›„ ê³¼ì •ì—ì„œëŠ” bodyë¥¼ ì½ì„ ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ë¯¸ë¦¬ `ContentCachingRequestWrapper`ë¥¼ í™œìš©í•˜ì—¬ AOPì—ì„œë„ ìš”ì²­ì— ì ‘ê·¼ê°€ëŠ¥ í•˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. 



### í•„í„° ë™ì‘

- `HttpServletRequest`ëŠ” bodyë¥¼ í•œ ë²ˆ ì½ìœ¼ë©´ ì†Œë©¸
- `ContentCachingRequestWrapper`ëŠ” bodyë¥¼ ë‚´ë¶€ ë²„í¼ì— ìºì‹±
- POST / PUT / DELETE ì²˜ëŸ¼ **bodyê°€ ìˆëŠ” ìš”ì²­ì—ë§Œ ì ìš©**
- GET ìš”ì²­ì€ QueryStringë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ wrapper ë¶ˆí•„ìš”

ì¦‰, **AOPì—ì„œ bodyë¥¼ ì½ì„ ìˆ˜ ìˆë„ë¡ ì‚¬ì „ ì‘ì—…ì„ í•´ë‘ëŠ” í•„í„°**ì…ë‹ˆë‹¤.



---

### 2ï¸âƒ£ FilterConfig.java â€“ í•„í„° ë“±ë¡

```java
@Configuration
public class FilterConfig {

	@Bean
	public FilterRegistrationBean<CachingRequestFilter> loggingFilter() {
		FilterRegistrationBean<CachingRequestFilter> registrationBean =
			new FilterRegistrationBean<>();

		registrationBean.setFilter(new CachingRequestFilter());
		registrationBean.addUrlPatterns("/*");
		registrationBean.setOrder(0);

		return registrationBean;
	}
}
```

- `order(0)`ìœ¼ë¡œ **ê°€ì¥ ì•ë‹¨ì—ì„œ ì‹¤í–‰**
- ì»¨íŠ¸ë¡¤ëŸ¬, ì¸í„°ì…‰í„°, AOPë³´ë‹¤ ë¨¼ì € bodyë¥¼ ê°ì‹¸ë„ë¡ ë³´ì¥

---

### 3ï¸âƒ£ @Idempotent ì–´ë…¸í…Œì´ì…˜

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Idempotent {
	int expireTime() default 7;
}
```

### ì—­í• 

- ë©±ë“±ì„± ê²€ì¦ì´ í•„ìš”í•œ ë©”ì„œë“œì—ë§Œ ì ìš©
- Redis TTLì„ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì œì–´
- **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë©±ë“±ì„± ë¡œì§ì„ ë¶„ë¦¬**

```java
@Idempotent(expireTime = 7)
public void matchUser(...) { ... }
```

------

## IdempotentAspect.java â€“ ë©±ë“±ì„± AOP ê²€ì¦

```java
@Aspect
@Component
@RequiredArgsConstructor
public class IdempotentAspect {

	private final StringRedisTemplate stringRedisTemplate;

	@Pointcut("@annotation(idempotent)")
	public void pointCut(Idempotent idempotent) {
	}

	@Before(value = "pointCut(idempotent)", argNames = "joinPoint, idempotent")
	public void before(JoinPoint joinPoint, Idempotent idempotent) throws IOException {
		HttpServletRequest request = ((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest();

		String requestKey = getRequestKey(request);
		String requestValue = getRequestValue(request);

		int expireTime = idempotent.expireTime();

		Boolean isPoss = stringRedisTemplate
			.opsForValue()
			.setIfAbsent(requestKey, requestValue, expireTime, TimeUnit.SECONDS);

		if (Boolean.FALSE.equals(isPoss)) {
			handleRequestException(requestKey, requestValue);
		}

	}

	private String getRequestKey(final HttpServletRequest request) {
		String token = request.getHeader("requestKey");

		if (token == null)
			throw new IllegalArgumentException();

		return token;
	}

	private String getRequestValue(final HttpServletRequest request) {
		if (!"GET".equalsIgnoreCase(request.getMethod())) {
			ContentCachingRequestWrapper cachingRequest = (ContentCachingRequestWrapper)request;

			return new String(cachingRequest.getContentAsByteArray(), StandardCharsets.UTF_8);
		} else {
			return request.getQueryString();
		}
	}

	private void handleRequestException(final String requestKey, final String requestValue) {

		String originRequestValue = stringRedisTemplate.opsForValue().get(requestKey);

		//ìš”ì²­ì´ ë‚´ìš©ì´ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ì„œ ì›ë˜ ìš”ì²­ì´ë‘ ê°™ì€ ê²½ìš°
		if (!requestValue.isBlank() && !requestValue.equals(originRequestValue))
			throw new IdempotentException(ResponseCode.UNPROCESSABLE_ENTITY);

		//ìš”ì²­ì´ ê°™ì§€ ì•Šì€ ê²½ìš°
		else
			throw new IdempotentException(ResponseCode.CONFLICT);
	}
}

```

ì´ AOPëŠ” **Service ë©”ì„œë“œ ì‹¤í–‰ ì§ì „ì—** ë™ì‘í•©ë‹ˆë‹¤.

### ì „ì²´ íë¦„

1. ìš”ì²­ì—ì„œ `requestKey` í—¤ë” ì¶”ì¶œ
2. ìš”ì²­ body(or query)ë¥¼ ë¬¸ìì—´ë¡œ ì¶”ì¶œ
3. Redisì— `SET NX` + TTL ì‹œë„
4. ì´ë¯¸ ì¡´ì¬í•˜ë©´ â†’ ì˜ˆì™¸ ì²˜ë¦¬



### ì¼€ì´ìŠ¤ ë¶„ê¸°

| ìƒí™©                | ì˜ë¯¸        | ì‘ë‹µ |
| ------------------- | ----------- | ---- |
| ê°™ì€ í‚¤ + ë‹¤ë¥¸ body | ì¬ì‚¬ìš©ëœ í‚¤ | 422  |
| ê°™ì€ í‚¤ + ê°™ì€ body | ì¤‘ë³µ í´ë¦­   | 409  |

ğŸ‘‰ **ë‹¨ìˆœ ì¤‘ë³µê³¼ ì˜ëª»ëœ ì¬ì‹œë„ë¥¼ êµ¬ë¶„**





## ì‹¤ì œ ì ìš©

ë§¤ì¹­ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” ì„œë¹„ìŠ¤ ë ˆì´ì–´ requestMatch ë©”ì„œë“œì— Idempotentë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì ìš©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 

![image](/assets/image-8731235.png)

![image](/assets/image-8731284.png)

Postmanì„ í†µí•´ ë™ì¼í•œ ìš”ì²­ì„ ì—°ì†ìœ¼ë¡œ í˜¸ì¶œí•´ ë©±ë“±ì„± ë™ì‘ì„ ê²€ì¦í–ˆìŠµë‹ˆë‹¤.

- **ì²« ë²ˆì§¸ ìš”ì²­**
  - ìƒˆë¡œìš´ `requestKey`ë¡œ ìš”ì²­
  - Redisì— í‚¤ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ ì •ìƒ ì²˜ë¦¬
  - **200 OK ì‘ë‹µ**
- **ë‘ ë²ˆì§¸ ìš”ì²­**
  - ë™ì¼í•œ `requestKey`ë¡œ ì¬ìš”ì²­
  - Redisì— ì´ë¯¸ ì²˜ë¦¬ ì´ë ¥ì´ ì¡´ì¬
  - Service ë¡œì§ ì‹¤í–‰ ì „ ì°¨ë‹¨
  - **409 Conflict ì‘ë‹µ**

ì´ë¥¼ í†µí•´ ê°™ì€ ìš”ì²­ì´ ì—¬ëŸ¬ ë²ˆ ì „ë‹¬ë˜ë”ë¼ë„
 **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ë‹¨ í•œ ë²ˆë§Œ ìˆ˜í–‰ë¨**ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

íŠ¹íˆ Controllerê¹Œì§€ëŠ” ìš”ì²­ì´ ë„ë‹¬í•˜ì§€ë§Œ,
 Service ì‹¤í–‰ ì§ì „ì— Redis ê¸°ë°˜ ë©±ë“±ì„± ê²€ì¦ì´ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì—
 í¬ì¸íŠ¸ ì°¨ê°ê³¼ ê°™ì€ í•µì‹¬ ë¡œì§ì„ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br/>

<br/>

<br/>





> Ref  
> https://sanggi-jayg.tistory.com/entry/%EB%A9%B1%EB%93%B1%EC%84%B1-Idempotence%EC%99%80-HTTP-API-%EC%84%A4%EA%B3%84 
> https://gukin-han.tistory.com/17
