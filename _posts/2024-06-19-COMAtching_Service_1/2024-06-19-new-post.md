---
layout: post
title: COMAtching 프로젝트 매칭 서비스 개발기-1
date: 2024-05-25 03:31
category: [COMAtching, Spring]
author: "greensnapback0229"
tags: [COMAtching, Spring]
summary: 
---

### 서론
COMAtching 서버를 개발하면서 해결하려고 했던 문제들과 내 고민들을 써보려고한다.
특히 이번 매칭 로직은 지금까지 내가 했던 비즈니스 로직중 가장 복잡한 서비스가 아니었나 싶다.
개발하며 했던 고민들을 정리해보고 개선할 부분들을 찾아보려고 한다.

**[개발하면서 그렸던 비즈니스 로직 흐름]**

![image](/assets/comatching_flow_sketch.jpg)

### 매칭 서비스 개요
> 매칭 서비스 유즈케이스 시나리오 + 서버에서 필요한 동작  
(※ operator / user 2명이 이 행동에 참여한다.)  

1. 서비스에 가입한 사용자가 포인트 충전 후 매칭을 위해 운영자에게 온다.
2. 매칭 요청을 하면 QR이 발급되고 관리자가 이를 인증한다. 
    - 요청 처리를 위해서 `request handler`에서 코드 발급, 요청 저장
3. 관리자가 QR인식으로 사용자를 인식한다.
    - 현재 존재하는 요청중 사용자가 유효한 요청인지 검증
4. 관리자 테블릿에서 매칭 옵션(MBTI, 연락빈도, 나이대, 취미 등)을 선택한다.
    - 선택한 옵션과 유저를 csv에 반영
5. 매칭 결과를 얻는다. 이는 추후 매칭 내역에서 확인 가능하다. 
    - 중복 방지를 위한 csv 반영
    - 매칭 내역 생성
    - User Point 차감
    - 매칭 Request 시간 update


일단 먼저든 생각은 한 서비스 클래스 내에서 해결할 수 없는 양이었다.
한 서비스가 여러 도메인과 기능들이 합쳐져 있었어서 책임 분배가 중요하다고 생각이 되었다.

**내가 분배한 책임**
 - 멤버 정보 관련 CRUD
 - 매칭 Request 관리
 - AI 프로그램 동작 관리
 - AI CSV 관리

![image](/assets/facasde_comatching.png)

> 크게 이렇게 4가지로 나누었고 이 기능들을 통합해서 하나의 API로 관리되도록 `Facade` 패턴의 형태로 개발.
{: .pormpt-tip}

***의도***  
<u>위 같이 분리한 것은 서로 의존하지 않는 상황을 원했음  </u>

Why? - 싱글톤 클래스들이 상태를 가졌기에 이를 여러 클래스에서 의존해서 사용하면 복잡도가 증가될거라 판단  
⇒ 로직에 대해 고민할때 각 도메인에 대해서만 생각할 수 있었음


### 1. 매칭 요청을 하면 발급되는 QR
![image](/assets/matchRquestFlow.png)

**고려사항, 요청사항**
- 클라이언트에서 코드를 가지고 QR을 생성하기 때문에 요청에 따른 코드를 발급해야함.
- 일정 시간 뒤에 삭제되어야함
- 잘못된 요청에 대한 처리
- 